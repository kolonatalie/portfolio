let posts=[],currentIndex=0;const batchSize=3;async function loadAndRenderInitialPosts(){try{const t=await fetch("../content/data/posts.json");posts=await t.json(),await renderPosts();window.location.hash&&await handleHashNavigation()}catch(t){showToast("Failed to load posts. Please try again")}}function createReactionButtonHTML(t,e,o){const n=getLikes(t,e);return`\n    <button class="like-btn${o===e?" reacted":""}" data-id="${t}" data-reaction="${e}">\n      ${e} <span class="reaction-count ${n>0?"":"hidden"}">${n}</span>\n    </button>\n  `}async function renderPosts(){const t=document.getElementById("feed"),e=document.getElementById("loading");e&&e.classList.remove("is-hidden");const o=posts.slice(currentIndex,currentIndex+3);try{const n=o.map((t=>fetch(t.file).then((t=>t.text())))),a=await Promise.all(n);for(let e=0;e<o.length;e++){const n=o[e],s=a[e],i=marked.parse(s),c=getSavedReaction(n.id),r=window.location.origin+window.location.pathname+`#post-${n.id}`,l=n.date,d=document.createElement("article");d.classList.add("post"),d.innerHTML=`\n        <h2 id="post-${n.id}">${n.title}</h2>\n        <div class="content">${i}</div>\n        <div class="post-footer">\n          <div class="reaction-buttons">\n            ${createReactionButtonHTML(n.id,"üëç",c)}\n            ${createReactionButtonHTML(n.id,"‚ù§Ô∏è",c)}\n            ${createReactionButtonHTML(n.id,"üî•",c)}\n          </div>\n          <p class="meta">üëÅÔ∏è  ${n.views} ‚Ä¢ ${l}</p>\n          <a href="#post-${n.id}" class="share-link" data-id="${n.id}" aria-label="Share this post"></a>\n        </div>\n        <input type="text" class="manual-copy-input" id="shareUrlInput-${n.id}" readonly value="${r}" aria-label="Shareable URL for this post">\n      `,t.appendChild(d)}}catch(t){showToast("Failed to load the post. Please try again")}finally{currentIndex+=3,e&&e.parentNode&&e.parentNode.removeChild(e)}}let isFetching=!1;function getLikes(t,e){return parseInt(localStorage.getItem(`likes-${t}-${e}`))||0}function addLike(t,e,o){if(e){let o=getLikes(t,e);o>0&&localStorage.setItem(`likes-${t}-${e}`,String(o-1))}let n=getLikes(t,o);localStorage.setItem(`likes-${t}-${o}`,String(n+1))}function getSavedReaction(t){return localStorage.getItem(`reacted-on-post-${t}`)}function saveReaction(t,e){localStorage.setItem(`reacted-on-post-${t}`,e)}function showToast(t){let e=document.querySelector(".toast");e||(e=document.createElement("div"),e.className="toast",document.body.appendChild(e)),e.textContent=t,e.classList.add("show"),setTimeout((()=>{e.classList.remove("show")}),2500)}function showNotFoundToast(){let t=document.querySelector(".notFound-toast");t||(t=document.createElement("div"),t.className="notFound-toast",document.body.appendChild(t)),t.innerHTML='\n    <div>\n      <h2>404</h2>\n      <p>Oops! The post you‚Äôre looking for doesn‚Äôt exist.</p>\n      <button class="btn-home"><a href="../blog/">Take me Home</a></button>\n    </div>\n  ',t.classList.add("show"),setTimeout((()=>{t.classList.remove("show")}),5e3)}async function handleHashNavigation(){const t=window.location.hash;if(!t)return;const e=t.replace("#post-","");let o=document.querySelector(t);if(!o){const n=posts.findIndex((t=>t.id==e));if(-1===n)return void showNotFoundToast();for(;currentIndex<=n&&(await renderPosts(),o=document.querySelector(t),!o););}if(o){const t=.2*window.innerHeight,e=o.getBoundingClientRect().top+window.scrollY-t;window.scrollTo({top:e,behavior:"smooth"});const n=o.closest(".post");n&&function(t){new IntersectionObserver(((t,e)=>{t.forEach((t=>{t.isIntersecting&&(t.target.classList.add("highlight"),setTimeout((()=>{t.target.classList.remove("highlight")}),2500),e.disconnect())}))}),{root:null,threshold:.5}).observe(t)}(n)}}window.addEventListener("scroll",(()=>{isFetching||currentIndex>=posts.length||window.innerHeight+window.scrollY>=document.body.offsetHeight-200&&(isFetching=!0,renderPosts().finally((()=>{isFetching=!1})))})),document.addEventListener("click",(async t=>{if(t.target.classList.contains("like-btn")){const e=t.target.dataset.id,o=t.target.dataset.reaction,n=getSavedReaction(e),a=t.target.closest(".post").querySelectorAll(".like-btn");if(a.forEach((t=>t.classList.remove("reacted"))),n===o){localStorage.removeItem(`reacted-on-post-${e}`);let t=getLikes(e,n);t>0&&localStorage.setItem(`likes-${e}-${n}`,String(t-1))}else t.target.classList.add("reacted"),addLike(e,n,o),saveReaction(e,o);a.forEach((t=>{const o=t.dataset.reaction,n=t.querySelector(".reaction-count"),a=getLikes(e,o);n.textContent=a,n.style.display=0===a?"none":"inline"}))}if(t.target.classList.contains("share-link")){t.preventDefault();const e=t.target.dataset.id,o=window.location.origin+window.location.pathname+`#post-${e}`,n=t.target.closest(".post").querySelector("h2").textContent,a=!/Mobi|Android|iPhone|iPad|iPod/i.test(navigator.userAgent),s=navigator.userAgent.includes("Macintosh")&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome");if(!navigator.share||a||s)try{await navigator.clipboard.writeText(o),showToast("Link copied to clipboard")}catch(e){showToast("Oops! Link didn‚Äôt copy, please copy it yourself.");const o=t.target.closest(".post").querySelector(".manual-copy-input");o&&(o.style.position="static",o.style.opacity="1",o.focus(),o.select(),setTimeout((()=>{o.style.position="absolute",o.style.opacity="0"}),1e4))}else try{await navigator.share({title:n,text:"Share this post",url:o})}catch(t){showToast("Couldn‚Äôt share. Please try again.")}}})),loadAndRenderInitialPosts(),window.addEventListener("hashchange",handleHashNavigation);